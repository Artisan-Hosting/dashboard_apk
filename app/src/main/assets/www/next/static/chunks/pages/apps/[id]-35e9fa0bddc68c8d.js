(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[218],{315:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/apps/[id]",function(){return s(3975)}])},3975:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>g,truncate:()=>m});var a=s(7876),l=s(767),r=s(3780),n=s(1059),o=s(1799);let c={Running:"text-green-400",Stopped:"text-red-400",Warning:"text-yellow-400",Building:"text-blue-400"};var i=s(9099),d=s(4232),x=s(8447),u=s(7685);function h(e){if(0===e)return"0 B";let t=Math.floor(Math.log(e)/Math.log(1024));return"".concat((e/Math.pow(1024,t)).toFixed(2)," ").concat(["B","KB","MB","GB","TB"][t])}let m=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return e.length>t?e.slice(12,t)+"…":e};function g(){let e=(0,i.useRouter)(),{id:t}=e.query,[s,g]=(0,d.useState)([]),[p,y]=(0,d.useState)([]),[b,v]=(0,d.useState)(null),[j,f]=(0,d.useState)({}),[w,N]=(0,d.useState)(null),[_,k]=(0,d.useState)({}),[S,C]=(0,d.useState)(!0),[R,P]=(0,d.useState)(""),B=(0,d.useRef)({}),[F,M]=(0,d.useState)(null),$=async(e,t)=>{try{let s=await (0,n.v$)("proxy/control/".concat(e,"/").concat(t));u.oR.success("".concat(t," sent to ").concat(e)),console.log("".concat(t," sent to ").concat(e),s)}catch(s){u.oR.error("Failed to send ".concat(t," to ").concat(e)),console.error("Failed to send command '".concat(t,"' to ").concat(e),s)}};return(0,d.useEffect)(()=>{e.isReady&&t&&(async()=>{try{let e=(await (0,n.v$)("proxy/runner/".concat(t))).data||[];y(e);let s=(await (0,n.v$)("proxy/usage/group/".concat(t))).data;v(s);let a=await Promise.all(e.map(async e=>{let t=await (0,n.v$)("proxy/usage/single/".concat(e.id));return{details:e,usage:t.data}}));g(a);let l={};await Promise.all(e.map(async e=>{try{var t;let s=await (0,n.v$)("proxy/logs/".concat(e.id,"/500"));l[e.id]=(null==(t=s.data)?void 0:t.lines)||[]}catch(t){console.error("Failed logs for ".concat(e.id),t)}})),k(l)}catch(e){console.error("Error loading runner + usage:",e)}finally{C(!1)}})()},[e.isReady,t]),(0,d.useEffect)(()=>{let e,s=async()=>{try{let e=await Promise.all(p.map(async e=>{let s=((await (0,n.v$)("proxy/runner/".concat(t))).data||[]).find(t=>t.id===e.id)||e,a=await (0,n.v$)("proxy/usage/single/".concat(e.id));return{details:s,usage:a.data}})),s=B.current;e.forEach(e=>{let{details:t}=e,a=s[t.id];a&&a!==t.status&&(0,u.oR)("Status changed: ".concat(t.id," is now ").concat(t.status),{icon:"Running"===t.status?"✅":"⚠️"}),s[t.id]=t.status}),g(e),P(new Date().toLocaleTimeString());let a={};await Promise.all(p.map(async e=>{try{var t;let s=await (0,n.v$)("proxy/logs/".concat(e.id,"/100"));a[e.id]=(null==(t=s.data)?void 0:t.lines)||[]}catch(t){console.error("Polling failed logs for ".concat(e.id),t)}})),k(a)}catch(e){console.error("Polling error:",e)}};return s(),e=setInterval(s,5e3),()=>clearInterval(e)},[t,p]),(0,a.jsxs)("div",{className:"relative min-h-screen flex bg-page text-foreground",children:[(0,a.jsx)(u.l$,{position:"bottom-right"}),(0,a.jsx)(l.B,{onLogout:o.v,onLogoutAll:o.u}),(0,a.jsxs)("main",{className:"flex-1 overflow-y-auto p-4 sm:p-6",children:[(0,a.jsxs)("h1",{className:"text-3xl font-bold text-brand mb-6",children:["Project: ",t]}),!S&&(0,a.jsx)("div",{className:"grid gap-8 grid-cols-1 md:grid-cols-2 lg:grid-cols-3",children:s.map(e=>{var t,s,l,r,n,o,i,d;let{details:u,usage:g}=e;j[u.id];let p=_[u.id]||[];return(0,a.jsxs)("div",{className:"card p-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-brand text-pretty",children:m(String(u.id),24)||"huh"}),(0,a.jsx)("p",{className:"text-sm ".concat(c[u.status]||"text-black"),children:u.status})]}),(0,a.jsxs)("div",{className:"hidden sm:flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>$(u.id,"start"),className:"bg-green-600 hover:bg-green-700 px-2 py-1 rounded text-white text-sm",children:"Start"}),(0,a.jsx)("button",{onClick:()=>$(u.id,"stop"),className:"bg-yellow-500 hover:bg-yellow-600 px-2 py-1 rounded text-white text-sm",children:"Stop"}),(0,a.jsx)("button",{onClick:()=>$(u.id,"restart"),className:"bg-brand hover:bg-brand-dark px-2 py-1 rounded text-white text-sm",children:"Restart"})]}),(0,a.jsxs)("div",{className:"relative sm:hidden",children:[(0,a.jsx)("button",{onClick:()=>M(F===u.id?null:u.id),className:"p-2 bg-brand rounded text-white",children:(0,a.jsx)(x.A,{className:"w-5 h-5"})}),F===u.id&&(0,a.jsxs)("div",{className:"absolute right-0 mt-2 bg-[#1b1e2e] p-2 rounded shadow-lg space-y-1 z-20",children:[(0,a.jsx)("button",{onClick:()=>{$(u.id,"start"),M(null)},className:"block w-full text-left px-2 py-1 rounded hover:bg-gray-700 text-sm",children:"Start"}),(0,a.jsx)("button",{onClick:()=>{$(u.id,"stop"),M(null)},className:"block w-full text-left px-2 py-1 rounded hover:bg-gray-700 text-sm",children:"Stop"}),(0,a.jsx)("button",{onClick:()=>{$(u.id,"restart"),M(null)},className:"block w-full text-left px-2 py-1 rounded hover:bg-gray-700 text-sm",children:"Restart"})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mt-4 text-sm text-gray-300",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("h3",{className:"font-semibold text-brand",children:"Health"}),(0,a.jsxs)("p",{children:["CPU Usage: ",null!=(n=null==(t=u.health)?void 0:t.cpu_usage)?n:"N/A"]}),(0,a.jsxs)("p",{children:["RAM Usage: ",null!=(o=null==(s=u.health)?void 0:s.ram_usage)?o:"N/A"]}),(0,a.jsxs)("p",{children:["TX: ",h(null!=(i=null==(l=u.health)?void 0:l.tx_bytes)?i:0)]}),(0,a.jsxs)("p",{children:["RX: ",h(null!=(d=null==(r=u.health)?void 0:r.rx_bytes)?d:0)]})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("h3",{className:"font-semibold text-brand",children:"Usage"}),(0,a.jsxs)("p",{children:["Total CPU Time: ",g.total_cpu.toFixed(3)," hrs"]}),(0,a.jsxs)("p",{children:["Avg Memory: ",g.avg_memory.toFixed(3)," MB"]}),(0,a.jsxs)("p",{children:["Peak Memory: ",g.peak_memory.toFixed(3)," MB"]})]})]}),p.length>0&&(0,a.jsxs)("details",{className:"mt-4",children:[(0,a.jsx)("summary",{className:"cursor-pointer font-semibold text-sm mb-2 text-brand",children:"Recent Logs"}),(0,a.jsx)("div",{className:"max-h-40 overflow-y-auto bg-black text-green-400 text-xs p-2 rounded border border-gray-700",children:p.map((e,t)=>(0,a.jsxs)("pre",{className:"whitespace-pre-wrap",children:["[",e.timestamp,"] ",e.message]},t))})]})]},u.id)})}),b&&!S&&w&&(0,a.jsxs)("div",{className:"mt-10 card p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4 text-brand",children:"Overall Usage & Billing"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-1 text-gray-300",children:[(0,a.jsxs)("p",{children:["Total CPU Time: ",b.total_cpu.toFixed(2)," hrs"]}),(0,a.jsxs)("p",{children:["Avg Memory:       ",b.avg_memory.toFixed(2)," MB"]}),(0,a.jsxs)("p",{children:["Total Instances:  ",s.length]}),(0,a.jsxs)("p",{children:["Samples:          ",b.total_samples]})]}),(0,a.jsxs)("div",{className:"space-y-1 text-gray-300",children:[(0,a.jsxs)("p",{children:["CPU Cost:      $",w.cpu_cost.toFixed(2)]}),(0,a.jsxs)("p",{children:["RAM Cost:      $",w.ram_cost.toFixed(2)]}),(0,a.jsxs)("p",{children:["Bandwidth:     $",w.bandwidth_cost.toFixed(2)]}),(0,a.jsxs)("p",{className:"font-semibold text-white",children:["Total Cost:    $",w.total_cost.toFixed(2)]})]})]})]})]}),S&&(0,a.jsx)(r.A,{})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[560,636,593,792],()=>t(315)),_N_E=e.O()}]);